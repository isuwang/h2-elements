<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="h2-label.html">
<!--

```javascript

<h2-radio id="radio" label="性别" value=1></h2-radio>
<h2-radio id="radio2" label="姓名" attr-for-value="id" attr-for-label="name" value=3></h2-radio>
<script>
    radio.items = [{value: 1, label: "男"}, {value: 2, label: "女"}];
     radio2.items = [{id: 1, name: "张三"}, {id: 2, name: "李四"}, {id: 3, name: "王五"}]
</script>
```
-->

<dom-module id="h2-radio">
    <template>
        <style>
            :host {
                display: inline-block;
                white-space: nowrap;
                text-align: left;
            }

            :host .item-wrap {
                display: flex;
            }

            :host .status-wrap {
                display: inline-block;
                position: relative;
                float: left;
            }

            :host label {
                display: inline-block;
                line-height: 34px;
                float: left;
            }

            :host .radio-label {
                vertical-align: middle;
            }

            :host iron-selector > * {
                padding: 6px 10px;
                font-size: 14px;
                cursor: pointer;
            }

            :host .status-items {
                display: inline-block;
                vertical-align: middle;
            }

            :host iron-selector .status {
                border-right: 1px solid #ccc;
                border-bottom: 1px solid #ccc;
                border-top: 1px solid #ccc;
                float: left;
                background-color: #ffffff;
            }

            /*第一项*/
            :host iron-selector span.status:first-child {
                border-left: 1px solid #ccc;
                border-top-left-radius: 4px;
                border-bottom-left-radius: 4px;
            }

            /*最后一项*/
            :host iron-selector span.status:last-of-type {
                border-top-right-radius: 4px;
                border-bottom-right-radius: 4px;
            }

            /*奇数项hover*/
            :host iron-selector span.status:nth-child(odd):hover {
                background-color: #0099FF;
                color: #fff;
                border-right: 1px solid #0099FF;
                border-bottom: 1px solid #0099FF;
                border-top: 1px solid #0099FF;
            }

            /*偶数项hover*/
            :host iron-selector span.status:nth-child(even):hover {
                background-color: var(--iron-selector-color-even, #0099FF);
                color: #fff;
                border-right: 1px solid var(--iron-selector-color-even, #0099FF);
                border-bottom: 1px solid var(--iron-selector-color-even, #0099FF);
                border-top: 1px solid var(--iron-selector-color-even, #0099FF);
            }

            /*奇数项选中*/
            :host iron-selector span.status:nth-child(odd).iron-selected {
                border-right: 1px solid #0099FF;
                border-bottom: 1px solid #0099FF;
                border-top: 1px solid #0099FF;
                background-color: #0099FF;
                color: #fff;
            }

            /*偶数项选中*/
            :host iron-selector span.status:nth-child(even).iron-selected {
                border-right: 1px solid var(--iron-selector-color-even, #0099FF);
                border-bottom: 1px solid var(--iron-selector-color-even, #0099FF);
                border-top: 1px solid var(--iron-selector-color-even, #0099FF);
                background-color: var(--iron-selector-color-even, #0099FF);
                color: #fff;
            }

            :host iron-selector .status:first-child.iron-selected {
                border-left: 1px solid #0099FF;
            }

            :host .required-input {
                border: 1px solid red;
                border-radius: 4px;
            }

            :host .shade {
                display: none;
                position: absolute;
                top: 0%;
                left: 0%;
                width: 100%;
                height: 100%;
                background-color: black;
                z-index: 99;
                opacity: .00;
                border-radius: 4px;
            }
        </style>
        <div class="item-wrap">
            <h2-label value="[[label]]" required="[[required]]"></h2-label>
            <div class="status-wrap">
                <iron-selector class="status-items" selected="{{value}}" attr-for-selected="radio-item">
                    <template is="dom-repeat" items="[[items]]">
                        <span class="status" radio-item="{{__getItemValueByName(item,attrForValue)}}">{{__getItemValueByName(item,attrForLabel)}}</span>
                    </template>
                </iron-selector>
                <div class="shade"></div>
            </div>
        </div>

    </template>
    <script>
        /**
         * `h2-radio`
         *
         * @customElement
         * @polymer
         * @demo demo/h2-radio/index.html
         */
        class H2Radio extends Polymer.Element {
            static get properties() {
                return {
                    /**
                     *
                     * 标签名字
                     * eg：1
                     *
                     * @attribute label
                     * @type {String}
                     */
                    label: {
                        type: String,
                        value: ""
                    },
                    /**
                     *
                     * 初始选择项和items的value值相对应
                     * eg：1
                     *
                     * @attribute selected
                     * @type {String}
                     */
                    value: {
                        type: String,
                        reflectToAttribute: true,
                        notify: true,
                        observer: "__valueChanged"
                    },
                    /**
                     *
                     * 需要展示的数据项
                     * eg：[{value:1,label:"全部",count:"19"}]
                     *
                     * @attribute items
                     * @type {Array}
                     */
                    items: {
                        type: Array,
                        value: []
                    },
                    /**
                     * 是否必填，默认非必填
                     * eg：true
                     */
                    required: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     * 是否可编辑,默认可以编辑
                     * eg：true
                     */
                    readonly: {
                        type: Boolean,
                        value: false,
                        observer: '_modeChange'
                    },
                    /**
                     * 用来取值的字段，默认为value
                     * 对应items：[{value:1,label:"全部",count:"19"}] value属性
                     */
                    attrForValue: {
                        type: String,
                        value: "value"
                    },
                    /**
                     * 用来展示的字段，默认为label
                     * 对应items：[{value:1,label:"全部",count:"19"}] label属性
                     */
                    attrForLabel: {
                        type: String,
                        value: "label"
                    }
                };
            }

            static get is() {
                return "h2-radio";
            }

            _modeChange(newVal) {
                if (newVal) {
                    this.root.querySelector('.shade').style.display = 'block';
                } else {
                    this.root.querySelector('.shade').style.display = 'none';
                }
            }

            __getItemValueByName(item, name) {
                if (item && name) {
                    return item[name]
                }
            }

            __valueChanged() {
                this.validate();
            }

            validate() {
                const verify_pss = this.required ? this.value !=undefined : true;
                let element = this.root.querySelector('.status-items');
                if (!verify_pss) {
                    element.classList.add("required-input");
                } else {
                    element.classList.remove("required-input");
                }
                return verify_pss
            }

            ready() {
                super.ready();
            }
        }

        window.customElements.define(H2Radio.is, H2Radio);
    </script>
</dom-module>
