<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="./behaviors/base-behavior.html">
<link rel="import" href="./h2-label.html">
<!--

```javascript

<h2-radio id="radio" label="性别" value=1></h2-radio>
<h2-radio id="radio2" label="姓名" attr-for-value="id" attr-for-label="name" value=3></h2-radio>
<script>
    radio.items = [{value: 1, label: "男"}, {value: 2, label: "女"}];
     radio2.items = [{id: 1, name: "张三"}, {id: 2, name: "李四"}, {id: 3, name: "王五"}]
</script>
```
-->

<dom-module id="h2-radio">
  <template>
    <style>
      :host {
        display: inline-block;
        height: 34px;
        line-height: 34px;
      }

      :host([hidden]) {
        display: none;
      }

      .radio-wrapper {
        display: flex;
      }

      .candidate-wrapper {
        display: inline-block;
        position: relative;
      }

      .candidate-items {
        display: inline-block;
        vertical-align: middle;
      }

      .candidate__item:first-of-type {
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
      }

      .candidate__item:last-of-type {
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
      }

      .candidate__item {
        height: inherit;
        line-height: inherit;
        padding: 0 8px;
        font-size: inherit;
        cursor: pointer;
        border: 1px solid #ccc;
        float: left;
        background-color: #ffffff;
      }

      .candidate__item:not(:last-of-type) {
        border-right: none;
      }

      .candidate__item:hover,
      .candidate__item.iron-selected {
        background-color: #0099FF;
        color: #fff;
        border-color: #0099FF;
      }

      :host([readonly]) .mask,
      :host([disabled]) .mask {
        position: absolute;
        top: -1px;
        bottom: -1px;
        right: -1px;
        left: -1px;
        background-color: rgba(255, 255, 255, 0.5);
        z-index: 10;
      }

    </style>
    <div class="radio-wrapper">
      <h2-label value="[[label]]"></h2-label>
      <div class="candidate-wrapper">
        <iron-selector class="candidate-items" selected="{{value}}" attr-for-selected="radio-item">
          <template is="dom-repeat" items="[[items]]">
            <span class="candidate__item" radio-item="[[ getValueByKey(item, attrForValue) ]]">
              [[ getValueByKey(item, attrForLabel) ]]
            </span>
          </template>
        </iron-selector>
        <div class="mask"></div>
      </div>
    </div>

  </template>
  <script>
    /**
     * `h2-radio`
     *
     * @customElement
     * @polymer
     * @demo demo/h2-radio/index.html
     */
    class H2Radio extends Polymer.mixinBehaviors([BaseBehavior], Polymer.Element) {
      static get properties() {
        return {
          /**
           *
           * 标签名字
           * eg：1
           *
           * @attribute label
           * @type {string}
           */
          label: {
            type: String
          },
          /**
           *
           * 初始选择项和items的value值相对应
           * eg：1
           *
           * @attribute selected
           * @type {string}
           */
          value: {
            type: String,
            notify: true
          },
          /**
           *
           * 需要展示的数据项
           * eg：[{value:1, label:"全部", count:"19"}]
           *
           * @attribute items
           * @type {array}
           */
          items: {
            type: Array
          },
          /**
           * 是否必填，默认非必填
           * eg：true
           * @type {boolean}
           */
          required: {
            type: Boolean,
            value: false
          },
          /**
           * 是否可编辑,默认可以编辑
           * eg：true
           * @type {boolean}
           */
          readonly: {
            type: Boolean,
            value: false
          },
          /**
           * 值字段名，默认为value
           * @type {string}
           */
          attrForValue: {
            type: String,
            value: "value"
          },
          /**
           * 用来展示的字段名，默认为label
           * @type {string}
           */
          attrForLabel: {
            type: String,
            value: "label"
          }
        };
      }

      static get is() {
        return "h2-radio";
      }

      static get observers() {
        return [
          '_requiredChanged(value, required, items)',
        ];
      }

      _requiredChanged(value, required, items = []) {
        if(required && items.length > 0 && value == undefined) {
          // 如果必填， 默认选中第一项
          this.value = items[0][this.attrForValue];
        }
      }

      validate() {
        return true;
      }
    }

    window.customElements.define(H2Radio.is, H2Radio);
  </script>
</dom-module>
