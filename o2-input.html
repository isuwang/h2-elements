<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="h2-input.html">
<!--
```javascript
<o2-input></o2-input>
```
-->

<dom-module id="o2-input">
    <template>
        <style>
            :host {
                display: flex;
            }

            :host * {
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
            }

            :host span.editBtn {
                background-color: #eeeeee;
                display: none;
                height: 34px;
                line-height: 22px;
                padding: 6px 10px;
                border: 1px solid #ccc;
                border-left: none;
                border-radius: 4px;
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
                font-size: 14px;
                cursor: pointer;
            }

            :host span.mouseover {
                border-color: #cccccc;
            }

            :host .view {
                display: inline-block;
                text-align: left;
                font-size: 14px;
                line-height: 34px;
                height: 34px;
                white-space: normal;
                width: auto;
                border: 1px solid transparent;
                padding: 0px 12px;
                border-radius: 4px;
                border-top-right-radius: 0;
                border-bottom-right-radius: 0;
            }
        </style>

        <h2-label value="[[label]]" required="[[required]]"></h2-label>
        <div id="container">
            <template is="dom-if" if="[[ isEdit ]]">
                <h2-input placeholder="[[placeholder]]" id="editor"
                          value="{{ value }}"></h2-input>
            </template>

            <template is="dom-if" if="[[ !isEdit ]]">
                <span id="displayer" class="view">[[value]]</span><!--不要删除此注释，用来处理inline-block元素之间的6个像素间隙的问题
                --><span class="editBtn">编辑</span>
            </template>
        </div>
    </template>

    <script>
        /**
         * `o2-input`
         *
         * @customElement
         * @polymer
         * @demo demo/o2-input/index.html
         */
        class O2Input extends Polymer.Element {
            static get properties() {
                return {
                    value: {
                        type: String,
                        notify: true
                    },
                    isEdit: {
                        type: Boolean,
                        value: false
                    },
                    label: {
                        type: String
                    },
                    placeholder: {
                        type: String
                    },
                    required: {
                        type: Boolean,
                        value: false
                    }
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
                this.$.container.addEventListener("mouseover", e => {
                    if (e.target.id === "displayer") {
                        e.target.classList.add("mouseover");
                        this._showEditBtn();
                    }
                });
                this.$.container.addEventListener("mouseout", e => {
                    if (e.target.id === "displayer") {
                        e.target.classList.remove("mouseover");
                        this._hideEditBtn();
                    }
                });
                this.$.container.addEventListener("click", e => {
                    if (e.target.id === "displayer") {
                        this.isEdit = true;
                        this._hideEditBtn();
                        setTimeout(
                            e => this.root.querySelector("h2-input").root.querySelector('input').focus(),
                            50
                        );
                    }
                });
                this.$.container.addEventListener("focusout", e => {
                    if (e.target.id === "editor") {
                        this.isEdit = false;
                        this._hideEditBtn();
                    }
                });
            }

            static get is() {
                return "o2-input";
            }

            _showEditBtn() {
                this.root.querySelector("span.editBtn").style.display = "inline-block";
            }

            _hideEditBtn() {
                this.root.querySelector("span.editBtn").style.display = "none";
            }
        }
        window.customElements.define(O2Input.is, O2Input);
    </script>
</dom-module>