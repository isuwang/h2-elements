<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="h2-input.html">
<!--
```javascript
<o2-input></o2-input>
```
-->

<dom-module id="o2-input">
    <template>
        <style>
            :host {
                display: flex;
            }

            :host * {
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
            }

            :host span.editBtn {
                background-color: #eeeeee;
                display: none;
                height: 34px;
                line-height: 22px;
                padding: 6px 10px;
                border: 1px solid #ccc;
                border-left: none;
                border-radius: 4px;
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
                font-size: 14px;
                cursor: pointer;
            }

            :host span.mouseover {
                border-color: #cccccc;
            }

            :host .view {
                display: inline-block;
                text-align: left;
                font-size: 14px;
                line-height: 34px;
                height: 34px;
                white-space: normal;
                width: auto;
                border: 1px solid transparent;
                padding: 0px 12px;
                border-radius: 4px;
                border-top-right-radius: 0;
                border-bottom-right-radius: 0;
            }

            :host div#container {
                font-size: 0; /*用来处理inline-block元素之间的6个像素间隙的问题*/
            }

            :host div.button-container {
                position: relative;
            }

            :host .buttons {
                position: absolute;
                right: 3px;
                top: 0px;
                z-index: 99;
                background-color: #f0f0f0;
                border: 1px solid #ccc;
                border-top: none;
                border-radius: 0 0 3px 3px;
                box-shadow: 0 3px 6px rgba(111, 111, 111, 0.2);
                outline: none;
                padding: 3px;
            }

            :host .buttons > button {
                background-color: #f0f0f0;
                border: 1px solid #cccccc;
                cursor: pointer;
                border-radius: 4px;
                padding: 0px;
            }

            :host .buttons > button:hover {
                background-color: #ffffff;
                border-color: #66afe9;
            }

            :host iron-icon {
                width: 20px;
                height: 20px;
            }

            :host .cancelBtn {
                margin-left: 3px;
            }
        </style>

        <h2-label value="[[label]]" required="[[required]]"></h2-label>
        <div id="container">
            <template is="dom-if" if="[[ isEdit ]]">
                <h2-input placeholder="[[placeholder]]" id="editor"
                          value="{{ value }}"></h2-input>
                <div class="button-container">
                    <div class="buttons">
                        <button title="保存">
                            <iron-icon icon="icons:check"></iron-icon>
                        </button>
                        <button title="取消" class="cancelBtn">
                            <iron-icon icon="icons:clear"></iron-icon>
                        </button>
                    </div>
                </div>
            </template>

            <template is="dom-if" if="[[ !isEdit ]]">
                <span id="displayer" class="view">[[value]]</span>
                <span id="editBtn" class="editBtn" title="点击开始编辑">编辑</span>
            </template>
        </div>
    </template>

    <script>
        /**
         * `o2-input`
         *
         * @customElement
         * @polymer
         * @demo demo/o2-input/index.html
         */
        class O2Input extends Polymer.Element {
            static get properties() {
                return {
                    value: {
                        type: String,
                        notify: true
                    },
                    isEdit: {
                        type: Boolean,
                        value: false
                    },
                    label: {
                        type: String
                    },
                    placeholder: {
                        type: String
                    },
                    required: {
                        type: Boolean,
                        value: false
                    }
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
                this.$.container.addEventListener("mouseover", e => {
                    console.log("鼠标悬浮" + e.target.nodeName);
                    if (e.target.id === "displayer" || e.target.id === "editBtn") {
                        this.root.querySelector("#displayer").classList.add("mouseover");
                        this._showEditBtn();
                    }
                });
                this.$.container.addEventListener("mouseout", e => {
                    console.log("鼠标离开" + e.target.nodeName);
                    if (e.target.id === "displayer" || e.target.id === "editBtn") {
                        this.root.querySelector("#displayer").classList.remove("mouseover");
                        this._hideEditBtn();
                    }
                });
                this.$.container.addEventListener("click", e => {
                    console.log("鼠标点击" + e.target.nodeName);
                    if (e.target.id === "displayer" || e.target.id === "editBtn") {
                        this.isEdit = true;
                        this._hideEditBtn();
                        setTimeout(
                            e => this.root.querySelector("h2-input").root.querySelector('input').focus(),
                            50
                        );
                    }
                });
                /*this.$.container.addEventListener("focusout", e => {
                 console.log("失去焦点" + e.target.nodeName);
                 if (e.target.id === "editor") {
                 this.isEdit = false;
                 this._hideEditBtn();
                 }
                 });*/
            }

            static get is() {
                return "o2-input";
            }

            _showEditBtn() {
                this.root.querySelector("span.editBtn").style.display = "inline-block";
            }

            _hideEditBtn() {
                this.root.querySelector("span.editBtn").style.display = "none";
            }
        }
        window.customElements.define(O2Input.is, O2Input);
    </script>
</dom-module>