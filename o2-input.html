<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="h2-input.html">

<!--

```javascript

<o2-input></o2-input>
```
-->

<dom-module id="o2-input">
    <template>
        <style>
            :host {
                text-align: left;
                display: flex;
                flex-flow: row nowrap;
                --suffix-unit-input: {
                    border-top-right-radius: 0;
                    border-bottom-right-radius: 0;
                }
            }

            :host * {
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
            }

            :host .input-container {
                display: flex;
            }

            :host div.editBtn {
                background-color: #eeeeee;
                display: inline-block;
                height: 34px;
                line-height: 22px;
                padding: 6px 10px;
                border: 1px solid #ccc;
                border-left: none;
                border-radius: 4px;
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
                font-size: 14px;
                cursor: pointer;
            }
        </style>
        <h2-label required=[[required]] value="[[label]]"></h2-label>
        <div class="input-container" tabindex="0">
            <h2-input
                    value="{{value}}"
                    placeholder="[[placeholder]]"
                    required=[[required]]
                    readonly="[[readonly]]">
            </h2-input>
            <template is="dom-if" if="[[!readonly]]">
                <div class="editBtn">编辑</div>
            </template>
        </div>
    </template>
    <script>
        /**
         * `o2-input`
         *
         * @customElement
         * @polymer
         * @demo demo/o2-input/index.html
         */
        class O2Input extends Polymer.Element {
            static get properties() {
                return {
                    /**
                     * 组件返回的输入框值
                     */
                    value: {
                        type: String,
                        notify: true
                    },
                    /**
                     * 组件的上一次value值
                     */
                    lastValue: {
                        type: String
                    },
                    /**
                     * 组件标签名
                     */
                    label: {
                        type: String
                    },
                    /**
                     * 组件占位符
                     */
                    placeholder: {
                        type: String
                    },
                    /**
                     * 是否必填
                     */
                    required: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     * 是否只读
                     */
                    readonly: {
                        type: Boolean,
                        value: true
                    }
                };
            }

            static get is() {
                return "o2-input";
            }

            connectedCallback() {
                super.connectedCallback();
                let container = this.root.querySelector("div.input-container");
                /*container.addEventListener("mouseout", e => {
                 /!*this._disableEdit(e);*!/
                 });*/
                container.addEventListener("mouseover", e => {
                    this._enableEdit(e);
                });
                container.addEventListener("focus", e => {
                    this._enableEdit(e);
                });
                container.addEventListener("blur", e => {
                    this._disableEdit(e);
                });
            }

            /**
             * 显示编辑模式，允许输入
             * @private
             */
            _enableEdit(e) {
                if (this.readonly) {
                    this.readonly = false;
                    this.lastValue = this.value;
                }

            }

            /**
             * 显示只读模式，禁止输入
             * @private
             */
            _disableEdit(e) {
                if (!this.readonly) {
                    this.readonly = true;
                    this.value = this.lastValue;
                }
            }
        }
        window.customElements.define(O2Input.is, O2Input);
    </script>
</dom-module>
